'use client';import { useEffect, useState } from 'react';import { auth, db } from '@/firebase/client';import { onAuthStateChanged } from 'firebase/auth';import { doc, getDoc } from 'firebase/firestore';import { useRouter } from 'next/navigation';export default function RequireApproved({role,children}:{role:'admin'|'supplier'|'client',children:React.ReactNode}){const [ok,setOk]=useState(false);const router=useRouter();useEffect(()=>{const sub=onAuthStateChanged(auth, async (u)=>{if(!u){router.replace('/ar/auth/login');return;}const ref=doc(db,'Users',u.uid);const snap=await getDoc(ref);const data=snap.data() as any;if(!data){router.replace('/ar/auth/login');return;}if(data.status!=='Approved'){router.replace('/ar/pending');return;}if(role!=='admin' && data.role!==role){router.replace('/ar');return;}setOk(true);});return ()=>sub();},[role,router]);if(!ok) return null;return <>{children}</>;}
